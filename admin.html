<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
</head>
<body>

<h2>ðŸŒ± GO GREEN â€“ Admin Dashboard</h2>

<button onclick="startCamera()">Open Camera</button>
<button onclick="markAttendance()">Capture & Mark Attendance</button>

<br><br>
<video id="video" width="240" autoplay></video>
<canvas id="canvas" width="240" height="180" style="display:none"></canvas>

<script>
const API_URL = "PASTE_NEW_EXEC_URL";
const email = localStorage.getItem("email");
const role  = localStorage.getItem("role");

if(!email || role!=="admin"){
  alert("Login required");
  location.href="index.html";
}

let stream;

function startCamera(){
  navigator.mediaDevices.getUserMedia({video:true})
    .then(s=>{stream=s;video.srcObject=s});
}

function markAttendance(){
  const ctx=canvas.getContext("2d");
  ctx.drawImage(video,0,0,240,180);

  navigator.geolocation.getCurrentPosition(pos=>{
    fetch(API_URL,{
      method:"POST",
      body:JSON.stringify({
        action:"markStaffAttendance",
        email:email,
        role:"ADMIN",
        latitude:pos.coords.latitude,
        longitude:pos.coords.longitude
      })
    }).then(r=>r.json()).then(d=>{
      alert(d.message);
      stream.getTracks().forEach(t=>t.stop());
    });
  });
}
</script>
</body>
</html>

