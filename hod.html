<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GO GREEN â€“ HOD Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/charts/loader.js"></script>
<style>
body{font-family:Arial;padding:20px;background:linear-gradient(135deg,#e8f5e9,#c8e6c9);}
button{background:#2e7d32;color:white;padding:8px;margin:4px;border:none}
#welcomeBar{background:#1b5e20;color:white;padding:12px;border-radius:8px}
</style>
</head>

<body>

<div id="welcomeBar"></div>
<h2>HOD Dashboard</h2>

<h3>ğŸ“ Faculty Leave Approval</h3>
<button onclick="loadLeaves()">Load Pending Leaves</button>
<table border="1">
<thead><tr><th>ID</th><th>Email</th><th>From</th><th>To</th><th>Action</th></tr></thead>
<tbody id="leaveBody"></tbody>
</table>

<h3>ğŸ¤– Substitute Suggestion</h3>
<button onclick="suggestSub()">Suggest Substitute</button>
<div id="subBox"></div>

<script>
const API="https://script.google.com/macros/s/AKfycbwV_SjR5wASHwKWjWd-fLlVFFWbc-pGAUUVXcYlEOUbH1JeUnwILr-nMhPvHWLoUW19BQ/exec";
const email=localStorage.getItem("email");
welcomeBar.innerText="Welcome HOD";

function post(d){
 return fetch(API,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(d)})
 .then(r=>r.json());
}

function loadLeaves(){
 const dept = localStorage.getItem("department");

post({
  action:"getPendingLeaves",
  department:dept
})
{
  leaveBody.innerHTML="";
  r.data.forEach(l=>{
   leaveBody.innerHTML+=`<tr>
   <td>${l[0]}</td><td>${l[1]}</td>
   <td>${l[2]}</td><td>${l[3]}</td>
   <td><button onclick="approve('${l[0]}')">Approve</button></td>
   </tr>`;
  });
 });
}

function approve(id){
 post({action:"approveLeave",leaveId:id,approver:email})
 .then(()=>loadLeaves());
}

function suggestSub(){
 post({action:"suggestSubstitute"})
 .then(r=>subBox.innerText="Suggested: "+(r.suggested||[]).join(", "));
}
</script>
</body>
</html>
