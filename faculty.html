<!DOCTYPE html>
<html>
<head>
<title>Generate QR</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;}
.box{
  background:#fff;
  margin:20px;
  padding:20px;
  border-radius:8px;
}
select,button{
  width:100%;
  padding:12px;
  margin-top:10px;
}
button{background:#0a5fb4;color:#fff;border:none;}
</style>
</head>
<body>

<script>
if (localStorage.getItem("login") !== "true") {
  window.location.replace("./index.html");
}
</script>

<div class="box">
  <h2>Generate Attendance QR</h2>

  <select id="subject">
    <option>Loading subjects...</option>
  </select>

  <button onclick="generateQR()">Generate QR</button>

  <div id="qr"></div>

  <button style="background:#c0392b" onclick="logout()">Logout</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwV_SjR5wASHwKWjWd-fLlVFFWbc-pGAUUVXcYlEOUbH1JeUnwILr-nMhPvHWLoUW19BQ/exec";

fetch(`${SCRIPT_URL}?action=getSubjects`)
  .then(r=>r.json())
  .then(data=>{
    const s=document.getElementById("subject");
    s.innerHTML="";
    data.forEach(d=>{
      const o=document.createElement("option");
      o.value=d.id;
      o.text=d.name;
      s.appendChild(o);
    });
  });

function generateQR(){
  const id=document.getElementById("subject").value;
  fetch(`${SCRIPT_URL}?action=generateQR&subjectId=${id}`)
    .then(r=>r.text())
    .then(url=>{
      document.getElementById("qr").innerHTML=`<img src="${url}" width="100%">`;
    });
}

function logout(){
  localStorage.clear();
  window.location.replace("./index.html");
}
</script>

</body>
</html>
