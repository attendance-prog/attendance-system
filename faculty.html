<!DOCTYPE html>
<html>
<head>
  <title>Generate Attendance QR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<h2>Generate Attendance QR</h2>

<select id="subjects">
  <option>Loading subjects...</option>
</select>

<button onclick="generateQR()">Generate QR</button>

<div id="qr"></div>

<button onclick="logout()">Logout</button>

<script>
const SCRIPT_URL = "PASTE_YOUR_NEW_EXEC_URL_HERE";
const email = localStorage.getItem("facultyEmail");

if (!email) location.href = "index.html";

fetch(`${SCRIPT_URL}?action=getSubjects&email=${encodeURIComponent(email)}`)
  .then(r => r.json())
  .then(list => {
    const sel = document.getElementById("subjects");
    sel.innerHTML = "";
    list.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s.id;
      opt.textContent = `${s.id} - ${s.name}`;
      sel.appendChild(opt);
    });
  });

function generateQR() {
  const subjectId = document.getElementById("subjects").value;

  fetch(`${SCRIPT_URL}?action=generateQR&email=${encodeURIComponent(email)}&subjectId=${subjectId}`)
    .then(r => r.text())
    .then(url => {
      document.getElementById("qr").innerHTML =
        `<img src="${url}"><p>${subjectId}</p>`;
    });
}

function logout() {
  localStorage.clear();
  location.href = "index.html";
}
</script>

</body>
</html>
