<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <style>
    body { font-family: Arial; background:#f4f6f9; }
    .card {
      background:white;
      padding:20px;
      margin:15px;
      border-radius:8px;
      box-shadow:0 2px 10px rgba(0,0,0,.1);
    }
    button {
      padding:10px;
      width:100%;
      margin-top:10px;
      background:#0a7;
      color:white;
      border:none;
    }
  </style>
</head>
<body>

<h2 id="roleTitle"></h2>

<div class="card" id="facultyBox" style="display:none;">
  <h3>Generate Attendance QR</h3>
  <select id="subjects">
    <option>Loading subjects...</option>
  </select>
  <button onclick="generateQR()">Generate QR</button>
</div>

<div class="card" id="adminBox" style="display:none;">
  <h3>Admin Controls</h3>
  <button>Manage Users</button>
  <button>Manage Subjects</button>
  <button>Manage Locations</button>
</div>

<button onclick="logout()">Logout</button>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwV_SjR5wASHwKWjWd-fLlVFFWbc-pGAUUVXcYlEOUbH1JeUnwILr-nMhPvHWLoUW19BQ/exec";
const role = localStorage.getItem("role");
document.getElementById("roleTitle").innerText = "Role: " + role;

if (["FACULTY","HOD","COORDINATOR"].includes(role)) {
  document.getElementById("facultyBox").style.display = "block";
  fetch(`${SCRIPT_URL}?action=getSubjects`)
    .then(r => r.json())
    .then(list => {
      const sel = document.getElementById("subjects");
      sel.innerHTML = "";
      list.forEach(s => {
        const o = document.createElement("option");
        o.value = s.id;
        o.text = `${s.id} - ${s.name}`;
        sel.appendChild(o);
      });
    });
}

if (role === "ADMIN") {
  document.getElementById("adminBox").style.display = "block";
}

function generateQR() {
  const sub = document.getElementById("subjects").value;
  window.open(`${SCRIPT_URL}?action=generateQR&subjectId=${sub}`);
}

function logout() {
  localStorage.clear();
  location.href = "index.html";
}
</script>

</body>
</html>
